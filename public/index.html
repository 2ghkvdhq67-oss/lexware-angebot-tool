<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>lexoffice Tool</title>
<style>
body{font-family:system-ui;margin:24px;max-width:800px}
.box{border:1px solid #ddd;border-radius:10px;padding:16px;margin-bottom:16px}
button{padding:10px 14px;border-radius:8px;border:1px solid #999}
.primary{background:#000;color:#fff}
pre{background:#f6f6f6;padding:12px;border-radius:8px;white-space:pre-wrap}
</style>
</head>
<body>

<h2>lexoffice Angebots-Tool</h2>

<div class="box">
  <button onclick="location.href='/download-template-with-articles'">Vorlage herunterladen</button>
  <button onclick="apiTest()">API testen</button>
</div>

<div class="box">
  <input id="file" type="file" accept=".xlsx"><br><br>
  <label><input id="testmode" type="checkbox" checked> Testmodus</label><br><br>
  <button class="primary" onclick="run()">Ausführen</button>
  <pre id="out">bereit</pre>
</div>

<script>
const out = document.getElementById("out");

async function apiTest(){
  out.textContent="API-Test läuft…";
  const r = await fetch("/api-test");
  const d = await r.json();
  out.textContent = JSON.stringify(d, null, 2);
}

async function run(){
  const f = document.getElementById("file").files[0];
  if(!f){ alert("Excel wählen"); return; }

  const test = document.getElementById("testmode").checked;
  const url = test ? "/validate-excel" : "/create-quote-from-excel";

  const fd = new FormData();
  fd.append("file", f);

  out.textContent="Verarbeitung…";
  const r = await fetch(url, { method:"POST", body:fd });
  const d = await r.json();
  out.textContent = JSON.stringify(d, null, 2);
}
</script>

</body>
</html>
